---
title: "ã€WWDC23ã€‘SwiftDataã‚’ç”¨ã„ãŸAppä½œæˆ"
emoji: "ğŸ’¾"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [iOS,Swift,SwiftUI,SwiftData]
published: true
published_at: 2024-06-24 07:00 # æœªæ¥ã®æ—¥æ™‚ã‚’æŒ‡å®šã™ã‚‹
---

![](/images/2024-06-21-15-35-05.png)

### SwiftUIã¨SwiftDataã‚’ç”¨ã„ãŸãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚«ãƒ¼ãƒ‰ã‚¢ãƒ—ãƒªã®ä½œæˆ

å…¬å¼ã®[ã‚µãƒ³ãƒ—ãƒ«](https://developer.apple.com/documentation/SwiftUI/Building-a-document-based-app-using-SwiftData)ã‚’å‚è€ƒã«è¨˜äº‹ã‚’è¨˜è¼‰ã—ã¾ã™ã€‚

#### ãƒ¢ãƒ‡ãƒ«ã®å®šç¾©

ãƒ¢ãƒ‡ãƒ«ã‚¯ãƒ©ã‚¹ã‚’SwiftDataã«å¯¾å¿œã•ã›ã¾ã™ã€‚ä»¥ä¸‹ã®ã‚ˆã†ã«`Card`ã‚¯ãƒ©ã‚¹ã‚’å®šç¾©ã—ã€`@Model`ãƒã‚¯ãƒ­ã‚’è¿½åŠ ã—ã¾ã™ã€‚`@Model`ãƒã‚¯ãƒ­ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ã€`Observable`ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã«ä¸€è‡´ã™ã‚‹ã‚ˆã†ã«ãªã‚Šã€`ObservableObject`ã®ä»£ã‚ã‚Šã«ä½¿ãˆã¾ã™ã€‚

```swift
import SwiftData

@Model
final class Card {
    var front: String
    var back: String
    var creationDate: Date

    init(front: String, back: String, creationDate: Date = .now) {
        self.front = front
        self.back = back
        self.creationDate = creationDate
    }
}
```

ã“ã®`@Model`ãƒã‚¯ãƒ­ã«ã‚ˆã‚Šã€`Card`ã‚¯ãƒ©ã‚¹ã¯è‡ªå‹•çš„ã«æ°¸ç¶šåŒ–ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

#### ãƒ‡ãƒ¼ã‚¿ã®ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°

`@Bindable`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãƒ©ãƒƒãƒ‘ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ã€ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ã‚’Viewã«ãƒã‚¤ãƒ³ãƒ‰ã—ã¾ã™ã€‚

```swift
@Bindable var card: Card
```

ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãªã©ã®UIè¦ç´ ãŒç›´æ¥ãƒ¢ãƒ‡ãƒ«ã«ãƒã‚¤ãƒ³ãƒ‰ã•ã‚Œã€ãƒ¢ãƒ‡ãƒ«ã®å¤‰æ›´ãŒè‡ªå‹•çš„ã«UIã«åæ˜ ã•ã‚Œã¾ã™ã€‚

#### ãƒ‡ãƒ¼ã‚¿ã®ã‚¯ã‚¨ãƒª

SwiftDataã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ã‚¨ãƒªã—ã¦è¡¨ç¤ºã™ã‚‹ã«ã¯ã€`@Query`ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```swift
@Query private var cards: [Card]
```

`@Query`ã¯SwiftDataã‹ã‚‰ãƒ¢ãƒ‡ãƒ«ã‚’ã‚¯ã‚¨ãƒªã—ã€ãƒ¢ãƒ‡ãƒ«ã®å¤‰æ›´ãŒViewã«åæ˜ ã•ã‚Œã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

#### ãƒ¢ãƒ‡ãƒ«ã‚³ãƒ³ãƒ†ãƒŠã®è¨­å®š

ãƒ¢ãƒ‡ãƒ«ã‚³ãƒ³ãƒ†ãƒŠã®è¨­å®šæ–¹æ³•ã«é–¢ã—ã¦ã§ã™ã€‚

![](/images/2024-06-21-15-37-44.png =600x)

`WindowGroup`ã§ãƒ¢ãƒ‡ãƒ«ã‚³ãƒ³ãƒ†ãƒŠã‚’è¨­å®šã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ã€WindowGroupå…¨ä½“ã§ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚

![](/images/2024-06-21-15-38-00.png =600x)

`Window`ã”ã¨ã«è¤‡æ•°ã®ãƒ¢ãƒ‡ãƒ«ã‚³ãƒ³ãƒ†ãƒŠã‚’è¨­å®šã§ãã¾ã™ã€‚

![](/images/2024-06-21-15-38-19.png =600x)

ä¸‹ä½ã®éšå±¤å†…ã«ãŠã„ã¦ã€åˆ¥ã§ãƒ¢ãƒ‡ãƒ«ã‚³ãƒ³ãƒ†ãƒŠã‚’è¨­å®šã§ãã¾ã™ã€‚

`WindowGroup`ã‚·ãƒ¼ãƒ³ã®ãƒ¢ãƒ‡ãƒ«ã‚³ãƒ³ãƒ†ãƒŠã‚’è¨­å®šã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ViewãŒSwiftDataã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚

```swift
WindowGroup {
    ContentView()
}
.modelContainer(for: Card.self)
```

#### Previewã®è¡¨ç¤º

ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ç”¨æ„ã—ã¾ã™ã€‚

```swift
struct SampleDeck {
    static var contents: [Card] = [
        Card(front: "Open Settings in a single click", back: "SettingsLink"),
        Card(front: "Configure the toolbar title display size", back: "toolbarTitleDisplayMode(_:)"),
        //çœç•¥
    ]
}
```

Previewã‚³ãƒ³ãƒ†ãƒŠã‚’ä½œæˆã—ã¾ã™ã€‚

```swift
@MainActor
let previewContainer: ModelContainer = {
    do {
        // ModelContainerã‚’ä½œæˆã—ã€ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ¡ãƒ¢ãƒªå†…ã«ã®ã¿ä¿å­˜ã—ã€æ°¸ç¶šåŒ–ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã›ãšã«ä½¿ç”¨ã™ã‚‹è¨­å®šã‚’è¿½åŠ 
        let container = try ModelContainer(
            for: Card.self,
            configurations: ModelConfiguration(isStoredInMemoryOnly: true)
        )
        let modelContext = container.mainContext

        // ãƒ¢ãƒ‡ãƒ«ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«æ—¢å­˜ã®ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã€ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’æŒ¿å…¥
        if try modelContext.fetch(FetchDescriptor<Card>()).isEmpty {
            SampleDeck.contents.forEach { container.mainContext.insert($0) }
        }
        return container
    } catch {
        // ã‚³ãƒ³ãƒ†ãƒŠã®ä½œæˆã«å¤±æ•—ã—ãŸå ´åˆã€ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡ºåŠ›ã—ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’çµ‚äº†
        fatalError("Failed to create container")
    }
}()
```

`Preview`ã«`previewContainer`ã‚’è¨­å®šã™ã‚‹ã€‚

```swift
#Preview {
    ContentView()
        .frame(minWidth: 500, minHeight: 500)
        .modelContainer(previewContainer)
}
```

#### ãƒ¢ãƒ‡ãƒ«ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹

ãƒ¢ãƒ‡ãƒ«ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã¾ã™ã€‚SwiftUIã§ã¯ã€`Environment`ã‚’ä½¿ç”¨ã—ã¦ãƒ¢ãƒ‡ãƒ«ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ã€‚

```swift
@Environment(\.modelContext) private var modelContext
```

æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã—ã€ãƒ¢ãƒ‡ãƒ«ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«æŒ¿å…¥ã—ã¾ã™ã€‚

```swift
let newCard = Card(front: "Sample Front", back: "Sample Back")
modelContext.insert(object: newCard)
```

#### ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ™ãƒ¼ã‚¹ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š

ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ™ãƒ¼ã‚¹ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¨­å®šã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã€ä¿å­˜ã€å…±æœ‰ãŒå¯èƒ½ã¨ãªã‚Šã¾ã™ã€‚ã¾ãšã€info.plistã§ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿ã®ã‚¿ã‚¤ãƒˆãƒ«ãƒ»æ‹¡å¼µå­ãƒ»identifierï¼ˆã‚³ãƒ¼ãƒ‰å†…ã¨åŒä¸€ï¼‰ãƒ»ConformsToã‚’è¨­å®šã—ã¾ã™ã€‚

![](/images/2024-06-21-15-41-49.png =600x)

info.plistã§è¨­å®šã—ãŸãƒ‡ãƒ¼ã‚¿ãƒ»ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã«å®£è¨€ã—ã¾ã™ã€‚

```swift
import UniformTypeIdentifiers

extension UTType {
    static var flashCards = UTType(exportedAs: "com.example.flashCards")
}
```

`DocumentGroup`ã«`contentType`ã‚’æŒ‡å®šã—ã¦å®Œäº†ã§ã™ã€‚

```swift
@main
struct SwiftDataFlashCardSample: App {
    var body: some Scene {
        #if os(iOS) || os(macOS)
        DocumentGroup(editing: Card.self, contentType: .flashCards) {
            ContentView()
        }
        #else
        WindowGroup {
            ContentView()
                .modelContainer(for: Card.self)
        }
        #endif
    }
}
```

ä¸Šè¨˜ã®è¨­å®šãƒ»å®Ÿè£…ã‚’è¡Œã†ã“ã¨ã«ã‚ˆã‚Šã€ã‚ªãƒªã‚¸ãƒŠãƒ«ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã—ã€ç®¡ç†ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

![](/images/2024-06-21-16-57-19.png =600x)

## æœ€å¾Œã«

é–“é•ã„ãƒ»æ°—ã«ãªã‚‹éƒ¨åˆ†ãŒã‚ã‚Šã¾ã—ãŸã‚‰ã€ã‚³ãƒ¡ãƒ³ãƒˆã„ãŸã ã‘ã‚‹ã¨å¤§å¤‰ã†ã‚Œã—ã„ã§ã™ã€‚
è‰¯ã‹ã£ãŸã¨æ€ã£ãŸã‚‰**è¨˜äº‹ã¸ã®ã„ã„ã­**ã€**Xã®ãƒ•ã‚©ãƒ­ãƒ¼**ã‚’ã‚ˆã‚ã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚

https://sites.google.com/view/muranakar

å€‹äººã§ã‚¢ãƒ—ãƒªã‚’ä½œæˆã—ã¦ã„ã¾ã™ã€‚è‰¯ã‹ã£ãŸã‚‰è¦—ã„ã¦ã¿ã¦ãã ã•ã„ã€‚

## å‚è€ƒè³‡æ–™

https://developer.apple.com/videos/play/wwdc2023/10154/
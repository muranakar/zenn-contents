---
title: "＝＝＝＝＝＝＝【Flutter】SQLiteでのDebugのTips"
emoji: "👋"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [Flutter, Dart, SQlite]
published: false
---

# SQLite を使用したデバッグ方法の解説

SQLite を使用した開発では、問題が発生した時のデバッグが重要です。この記事では、SQLite のデバッグ方法について、具体的な実装例を交えながら詳しく解説していきます。

## デバッグログの実装方法

### 実験的な Logger の活用

SQLite のデバッグで最も効果的な方法の一つが、`SqfliteDatabaseFactoryLogger`を使用したログ出力です。

```dart:debug_example.dart
// データベースの操作をログ出力するための実装例
import 'package:sqflite_common/sqflite_logger.dart';

Future<void> main() async {
  // ロガーの設定とデータベースの初期化
  var factoryWithLogs = SqfliteDatabaseFactoryLogger(
    databaseFactory,
    options: SqfliteLoggerOptions(
      type: SqfliteDatabaseFactoryLoggerType.all
    )
  );

  // データベースの作成とテーブル定義
  var db = await factoryWithLogs.openDatabase(
    inMemoryDatabasePath,
    options: OpenDatabaseOptions(
      version: 1,
      onCreate: (db, _) {
        db.execute('''
          CREATE TABLE Product (
            id TEXT PRIMARY KEY,
            title TEXT
          )
        ''');
      }
    )
  );

  await db.close();
}
```

このコードを実行すると、以下のような詳細なログが出力されます：

```
openDatabase:({path: :memory:, options: {readOnly: false, singleInstance: true, version: 1}, sw: 0:00:00.009744})
query(query:({db: 1, sql: PRAGMA user_version, result: [{user_version: 0}], sw: 0:00:00.006656}))
execute(execute:({db: 1, sql: BEGIN EXCLUSIVE, result: {transactionId: 1}, sw: 0:00:00.001008}))
query(query:({db: 1, txn: 1, sql: PRAGMA user_version, result: [{user_version: 0}], sw: 0:00:00.000166}))
execute(execute:({db: 1, txn: 1, sql:   CREATE TABLE Product (
    id TEXT PRIMARY KEY,
    title TEXT
   ), sw: 0:00:00.000228}))
execute(execute:({db: 1, txn: 1, sql: PRAGMA user_version = 1, sw: 0:00:00.000057}))
execute(execute:({db: 1, txn: 1, sql: COMMIT, sw: 0:00:00.000138}))
closeDatabase:({db: 1, sw: 0:00:00.001952})
```

### シンプルなデバッグログの実装

より簡単にデバッグログを有効にしたい場合は、以下の方法があります：

```dart:quick_debug.dart
// クイックデバッグログの実装
var factoryWithLogs = factory.debugQuickLoggerWrapper();

// もしくはグローバルなログ設定
databaseFactory = databaseFactory.debugQuickLoggerWrapper();
```

## データベースの内容確認

### テーブル構造の確認

開発中にデータベースの状態を確認したい場合、以下のコードで既存のテーブル情報を取得できます：

```dart:table_check.dart
// sqlite_masterテーブルの確認
print(await db.query("sqlite_master"));
```

### テーブルの内容確認

特定のテーブルの中身を確認したい場合は、以下のように実装します：

```dart:content_check.dart
// テーブルの内容を出力
print(await db.query("my_table"));
```

## まとめ

SQLite のデバッグでは、適切なログ出力とデータベースの状態確認が重要です。この記事で紹介した手法を組み合わせることで、効率的なデバッグが可能になります。

## 参照

https://github.com/tekartik/sqflite/blob/master/sqflite/doc/dev_tips.md

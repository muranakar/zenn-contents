---
title: "ï¼ï¼ï¼ï¼ï¼ï¼ï¼ã€Flutterã€‘SQLiteã§ã®Debugã®Tips"
emoji: "ğŸ‘‹"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [Flutter, Dart, SQlite]
published: false
---

# SQLite ã‚’ä½¿ç”¨ã—ãŸãƒ‡ãƒãƒƒã‚°æ–¹æ³•ã®è§£èª¬

SQLite ã‚’ä½¿ç”¨ã—ãŸé–‹ç™ºã§ã¯ã€å•é¡ŒãŒç™ºç”Ÿã—ãŸæ™‚ã®ãƒ‡ãƒãƒƒã‚°ãŒé‡è¦ã§ã™ã€‚ã“ã®è¨˜äº‹ã§ã¯ã€SQLite ã®ãƒ‡ãƒãƒƒã‚°æ–¹æ³•ã«ã¤ã„ã¦ã€å…·ä½“çš„ãªå®Ÿè£…ä¾‹ã‚’äº¤ãˆãªãŒã‚‰è©³ã—ãè§£èª¬ã—ã¦ã„ãã¾ã™ã€‚

## ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã®å®Ÿè£…æ–¹æ³•

### å®Ÿé¨“çš„ãª Logger ã®æ´»ç”¨

SQLite ã®ãƒ‡ãƒãƒƒã‚°ã§æœ€ã‚‚åŠ¹æœçš„ãªæ–¹æ³•ã®ä¸€ã¤ãŒã€`SqfliteDatabaseFactoryLogger`ã‚’ä½¿ç”¨ã—ãŸãƒ­ã‚°å‡ºåŠ›ã§ã™ã€‚

```dart:debug_example.dart
// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æ“ä½œã‚’ãƒ­ã‚°å‡ºåŠ›ã™ã‚‹ãŸã‚ã®å®Ÿè£…ä¾‹
import 'package:sqflite_common/sqflite_logger.dart';

Future<void> main() async {
  // ãƒ­ã‚¬ãƒ¼ã®è¨­å®šã¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®åˆæœŸåŒ–
  var factoryWithLogs = SqfliteDatabaseFactoryLogger(
    databaseFactory,
    options: SqfliteLoggerOptions(
      type: SqfliteDatabaseFactoryLoggerType.all
    )
  );

  // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ä½œæˆã¨ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©
  var db = await factoryWithLogs.openDatabase(
    inMemoryDatabasePath,
    options: OpenDatabaseOptions(
      version: 1,
      onCreate: (db, _) {
        db.execute('''
          CREATE TABLE Product (
            id TEXT PRIMARY KEY,
            title TEXT
          )
        ''');
      }
    )
  );

  await db.close();
}
```

ã“ã®ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ãªè©³ç´°ãªãƒ­ã‚°ãŒå‡ºåŠ›ã•ã‚Œã¾ã™ï¼š

```
openDatabase:({path: :memory:, options: {readOnly: false, singleInstance: true, version: 1}, sw: 0:00:00.009744})
query(query:({db: 1, sql: PRAGMA user_version, result: [{user_version: 0}], sw: 0:00:00.006656}))
execute(execute:({db: 1, sql: BEGIN EXCLUSIVE, result: {transactionId: 1}, sw: 0:00:00.001008}))
query(query:({db: 1, txn: 1, sql: PRAGMA user_version, result: [{user_version: 0}], sw: 0:00:00.000166}))
execute(execute:({db: 1, txn: 1, sql:   CREATE TABLE Product (
    id TEXT PRIMARY KEY,
    title TEXT
   ), sw: 0:00:00.000228}))
execute(execute:({db: 1, txn: 1, sql: PRAGMA user_version = 1, sw: 0:00:00.000057}))
execute(execute:({db: 1, txn: 1, sql: COMMIT, sw: 0:00:00.000138}))
closeDatabase:({db: 1, sw: 0:00:00.001952})
```

### ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã®å®Ÿè£…

ã‚ˆã‚Šç°¡å˜ã«ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã‚’æœ‰åŠ¹ã«ã—ãŸã„å ´åˆã¯ã€ä»¥ä¸‹ã®æ–¹æ³•ãŒã‚ã‚Šã¾ã™ï¼š

```dart:quick_debug.dart
// ã‚¯ã‚¤ãƒƒã‚¯ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã®å®Ÿè£…
var factoryWithLogs = factory.debugQuickLoggerWrapper();

// ã‚‚ã—ãã¯ã‚°ãƒ­ãƒ¼ãƒãƒ«ãªãƒ­ã‚°è¨­å®š
databaseFactory = databaseFactory.debugQuickLoggerWrapper();
```

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®å†…å®¹ç¢ºèª

### ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ ã®ç¢ºèª

é–‹ç™ºä¸­ã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®çŠ¶æ…‹ã‚’ç¢ºèªã—ãŸã„å ´åˆã€ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã§æ—¢å­˜ã®ãƒ†ãƒ¼ãƒ–ãƒ«æƒ…å ±ã‚’å–å¾—ã§ãã¾ã™ï¼š

```dart:table_check.dart
// sqlite_masterãƒ†ãƒ¼ãƒ–ãƒ«ã®ç¢ºèª
print(await db.query("sqlite_master"));
```

### ãƒ†ãƒ¼ãƒ–ãƒ«ã®å†…å®¹ç¢ºèª

ç‰¹å®šã®ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä¸­èº«ã‚’ç¢ºèªã—ãŸã„å ´åˆã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ã«å®Ÿè£…ã—ã¾ã™ï¼š

```dart:content_check.dart
// ãƒ†ãƒ¼ãƒ–ãƒ«ã®å†…å®¹ã‚’å‡ºåŠ›
print(await db.query("my_table"));
```

## ã¾ã¨ã‚

SQLite ã®ãƒ‡ãƒãƒƒã‚°ã§ã¯ã€é©åˆ‡ãªãƒ­ã‚°å‡ºåŠ›ã¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®çŠ¶æ…‹ç¢ºèªãŒé‡è¦ã§ã™ã€‚ã“ã®è¨˜äº‹ã§ç´¹ä»‹ã—ãŸæ‰‹æ³•ã‚’çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ã€åŠ¹ç‡çš„ãªãƒ‡ãƒãƒƒã‚°ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

## å‚ç…§

https://github.com/tekartik/sqflite/blob/master/sqflite/doc/dev_tips.md

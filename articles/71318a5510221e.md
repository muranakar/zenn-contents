---
title: "SwiftDataã‚’ä½¿ç”¨ã—ãŸãƒ¢ãƒ‡ãƒ«ã®ã‚¹ã‚­ãƒ¼ãƒä½œæˆã¨ç§»è¡Œæ–¹æ³•"
emoji: "ğŸ’¾"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [iOS,Swift,SwiftUI,SwiftData]
published: false
---

![](/images/2024-06-23-21-09-12.png)

![](/images/2024-06-23-21-09-34.png)

![](/images/2024-06-23-21-09-48.png)

![](/images/2024-06-23-21-10-08.png)

![](/images/2024-06-23-21-10-20.png)

![](/images/2024-06-23-21-10-35.png)

![](/images/2024-06-23-21-10-47.png)

![](/images/2024-06-23-21-13-50.png)

![](/images/2024-06-23-21-14-15.png)

![](/images/2024-06-23-21-14-31.png)

![](/images/2024-06-23-21-14-46.png)

![](/images/2024-06-23-21-15-02.png)

![](/images/2024-06-23-21-15-24.png)

## SwiftDataã‚’ä½¿ç”¨ã—ãŸãƒ¢ãƒ‡ãƒ«ã®ã‚¹ã‚­ãƒ¼ãƒä½œæˆã¨ç§»è¡Œæ–¹æ³•

SwiftDataã¯ã€ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒªãƒ³ã‚°ã¨ç®¡ç†ã®ãŸã‚ã®å¼·åŠ›ãªãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã‚ã‚Šã€ãƒ¢ãƒ€ãƒ³ãªSwiftã‚¢ãƒ—ãƒªã‚’æ§‹ç¯‰ã™ã‚‹ãŸã‚ã®æ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ã€‚ã“ã®ã‚¬ã‚¤ãƒ‰ã§ã¯ã€SwiftDataã®ã‚¹ã‚­ãƒ¼ãƒãƒã‚¯ãƒ­ã‚’æœ€å¤§é™ã«æ´»ç”¨ã™ã‚‹æ–¹æ³•ã¨ã€ã‚¢ãƒ—ãƒªã®å¤‰æ›´ã«ä¼´ã†ã‚¹ã‚­ãƒ¼ãƒç§»è¡Œã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚ä¾‹ã¨ã—ã¦ã€ã€ŒSampleTripsã€ã‚¢ãƒ—ãƒªã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ã“ã®ã‚¢ãƒ—ãƒªã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä»Šå¾Œã®æ—…è¡Œã‚’è¨ˆç”»ã™ã‚‹ãŸã‚ã®ã‚‚ã®ã§ã™ã€‚

### åˆæœŸãƒ¢ãƒ‡ãƒ«ã®ä½œæˆ

ã¾ãšã€åŸºæœ¬çš„ãªTripãƒ¢ãƒ‡ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚ã“ã®ãƒ¢ãƒ‡ãƒ«ã¯ã€æ—…è¡Œã®åå‰ã€ç›®çš„åœ°ã€é–‹å§‹æ—¥ã€çµ‚äº†æ—¥ã‚’æŒã¡ã€ãƒã‚±ãƒƒãƒˆãƒªã‚¹ãƒˆé …ç›®ã¨å®¿æ³Šæ–½è¨­ã®é–¢ä¿‚ã‚’å«ã¿ã¾ã™ã€‚

```swift
import SwiftUI
import SwiftData

// ãƒ¢ãƒ‡ãƒ«ã‚¯ãƒ©ã‚¹Tripã‚’å®šç¾©
@Model
final class Trip {
    var name: String
    var destination: String
    var start_date: Date
    var end_date: Date
    
    var bucketList: [BucketListItem]? = []
    var livingAccommodation: LivingAccommodation?
}
```

### ä¸€æ„ãªå±æ€§ã®è¿½åŠ 

æ¬¡ã«ã€æ—…è¡ŒåãŒä¸€æ„ã§ã‚ã‚‹ã“ã¨ã‚’ä¿è¨¼ã™ã‚‹ãŸã‚ã«ã€`@Attribute`ã‚¹ã‚­ãƒ¼ãƒãƒã‚¯ãƒ­ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```swift
@Model 
final class Trip {
    // åå‰ã®ä¸€æ„æ€§ã‚’ä¿è¨¼ã™ã‚‹ãŸã‚ã®å±æ€§ã‚’è¨­å®š
    @Attribute(.unique) var name: String
    var destination: String
    var start_date: Date
    var end_date: Date
    
    var bucketList: [BucketListItem]? = []
    var livingAccommodation: LivingAccommodation?
}
```

### ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£åã®å¤‰æ›´

`start_date`ã¨`end_date`ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£åã‚’å¤‰æ›´ã—ãŸã„å ´åˆã¯ã€`@Attribute`ãƒã‚¯ãƒ­ã®`originalName`ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã—ã¦å…ƒã®åå‰ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã™ã‚‹ã“ã¨ã§ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒã—ã¾ã™ã€‚

```swift
@Model 
final class Trip {
    // åå‰ã®ä¸€æ„æ€§ã‚’ä¿è¨¼ã™ã‚‹ãŸã‚ã®å±æ€§ã‚’è¨­å®š
    @Attribute(.unique) var name: String
    var destination: String
    // å…ƒã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£åã‚’ãƒãƒƒãƒ”ãƒ³ã‚°
    @Attribute(originalName: "start_date") var startDate: Date
    @Attribute(originalName: "end_date") var endDate: Date
    
    var bucketList: [BucketListItem]? = []
    var livingAccommodation: LivingAccommodation?
}
```

### ã‚«ã‚¹ã‚±ãƒ¼ãƒ‰å‰Šé™¤ãƒ«ãƒ¼ãƒ«ã®è¨­å®š

æ—…è¡ŒãŒå‰Šé™¤ã•ã‚ŒãŸã¨ãã«ã€ãƒã‚±ãƒƒãƒˆãƒªã‚¹ãƒˆé …ç›®ã‚„å®¿æ³Šæ–½è¨­ã‚‚å‰Šé™¤ã•ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã«ã€`@Relationship`ãƒã‚¯ãƒ­ã‚’ä½¿ç”¨ã—ã¦ã‚«ã‚¹ã‚±ãƒ¼ãƒ‰å‰Šé™¤ãƒ«ãƒ¼ãƒ«ã‚’è¨­å®šã—ã¾ã™ã€‚

```swift
@Model 
final class Trip {
    // åå‰ã®ä¸€æ„æ€§ã‚’ä¿è¨¼ã™ã‚‹ãŸã‚ã®å±æ€§ã‚’è¨­å®š
    @Attribute(.unique) var name: String
    var destination: String
    // å…ƒã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£åã‚’ãƒãƒƒãƒ”ãƒ³ã‚°
    @Attribute(originalName: "start_date") var startDate: Date
    @Attribute(originalName: "end_date") var endDate: Date
    
    // ã‚«ã‚¹ã‚±ãƒ¼ãƒ‰å‰Šé™¤ãƒ«ãƒ¼ãƒ«ã‚’æŒã¤é–¢ä¿‚ã‚’å®šç¾©
    @Relationship(.cascade)
    var bucketList: [BucketListItem]? = []
  
    @Relationship(.cascade)
    var livingAccommodation: LivingAccommodation?
}
```

### æ°¸ç¶šåŒ–ã—ãªã„ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®è¿½åŠ 

`@Transient`ãƒã‚¯ãƒ­ã‚’ä½¿ç”¨ã—ã¦æ°¸ç¶šåŒ–ã—ãªã„ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¿½åŠ ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ä¾‹ãˆã°æ—…è¡Œã®ãƒ“ãƒ¥ãƒ¼æ•°ã‚’è¿½è·¡ã™ã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’æ°¸ç¶šåŒ–ã›ãšã«ç®¡ç†ã§ãã¾ã™ã€‚

```swift
@Model 
final class Trip {
    // åå‰ã®ä¸€æ„æ€§ã‚’ä¿è¨¼ã™ã‚‹ãŸã‚ã®å±æ€§ã‚’è¨­å®š
    @Attribute(.unique) var name: String
    var destination: String
    // å…ƒã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£åã‚’ãƒãƒƒãƒ”ãƒ³ã‚°
    @Attribute(originalName: "start_date") var startDate: Date
    @Attribute(originalName: "end_date") var endDate: Date
    
    // ã‚«ã‚¹ã‚±ãƒ¼ãƒ‰å‰Šé™¤ãƒ«ãƒ¼ãƒ«ã‚’æŒã¤é–¢ä¿‚ã‚’å®šç¾©
    @Relationship(.cascade)
    var bucketList: [BucketListItem]? = []
  
    @Relationship(.cascade)
    var livingAccommodation: LivingAccommodation?

    // æ°¸ç¶šåŒ–ã—ãªã„ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å®šç¾©
    @Transient
    var tripViews: Int = 0
}
```

### ãƒãƒ¼ã‚¸ãƒ§ãƒ³åŒ–ã•ã‚ŒãŸã‚¹ã‚­ãƒ¼ãƒã®å®šç¾©

ã‚¹ã‚­ãƒ¼ãƒã®å¤‰æ›´ã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã«ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³åŒ–ã•ã‚ŒãŸã‚¹ã‚­ãƒ¼ãƒã‚’å®šç¾©ã—ã¾ã™ã€‚

```swift
// ãƒãƒ¼ã‚¸ãƒ§ãƒ³1ã®ã‚¹ã‚­ãƒ¼ãƒã‚’å®šç¾©
enum SampleTripsSchemaV1: VersionedSchema {
    static var models: [any PersistentModel.Type] {
        [Trip.self, BucketListItem.self, LivingAccommodation.self]
    }

    @Model
    final class Trip {
        var name: String
        var destination: String
        var start_date: Date
        var end_date: Date
    
        var bucketList: [BucketListItem]? = []
        var livingAccommodation: LivingAccommodation?
    }

    // ä»–ã®ãƒ¢ãƒ‡ãƒ«ã‚‚ã“ã“ã§å®šç¾©
}

// ãƒãƒ¼ã‚¸ãƒ§ãƒ³2ã®ã‚¹ã‚­ãƒ¼ãƒã‚’å®šç¾©
enum SampleTripsSchemaV2: VersionedSchema {
    static var models: [any PersistentModel.Type] {
        [Trip.self, BucketListItem.self, LivingAccommodation.self]
    }

    @Model
    final class Trip {
        @Attribute(.unique) var name: String
        var destination: String
        var start_date: Date
        var end_date: Date
    
        var bucketList: [BucketListItem]? = []
        var livingAccommodation: LivingAccommodation?
    }

    // ä»–ã®ãƒ¢ãƒ‡ãƒ«ã‚‚ã“ã“ã§å®šç¾©
}

// ãƒãƒ¼ã‚¸ãƒ§ãƒ³3ã®ã‚¹ã‚­ãƒ¼ãƒã‚’å®šç¾©
enum SampleTripsSchemaV3: VersionedSchema {
    static var models: [any PersistentModel.Type] {
        [Trip.self, BucketListItem.self, LivingAccommodation.self]
    }

    @Model
    final class Trip {
        @Attribute(.unique) var name: String
        var destination: String
        @Attribute(originalName: "start_date") var startDate: Date
        @Attribute(originalName: "end_date") var endDate: Date
    
        var bucketList: [BucketListItem]? = []
        var livingAccommodation: LivingAccommodation?
    }

    // ä»–ã®ãƒ¢ãƒ‡ãƒ«ã‚‚ã“ã“ã§å®šç¾©
}
```

### ã‚¹ã‚­ãƒ¼ãƒç§»è¡Œãƒ—ãƒ©ãƒ³ã®å®Ÿè£…

ã‚¹ã‚­ãƒ¼ãƒç§»è¡Œãƒ—ãƒ©ãƒ³ã‚’å®Ÿè£…ã—ã¦ã€ç•°ãªã‚‹ã‚¹ã‚­ãƒ¼ãƒãƒãƒ¼ã‚¸ãƒ§ãƒ³é–“ã®ç§»è¡Œã‚’ç®¡ç†ã—ã¾ã™ã€‚

```swift
// ã‚¹ã‚­ãƒ¼ãƒç§»è¡Œãƒ—ãƒ©ãƒ³ã‚’å®šç¾©
enum SampleTripsMigrationPlan: SchemaMigrationPlan {
    static var schemas: [any VersionedSchema.Type] {
        [SampleTripsSchemaV1.self, SampleTripsSchemaV2.self, SampleTripsSchemaV3.self]
    }
    
    static var stages: [MigrationStage] {
        [migrateV1toV2, migrateV2toV3]
    }

    // ãƒãƒ¼ã‚¸ãƒ§ãƒ³1ã‹ã‚‰2ã¸ã®ã‚«ã‚¹ã‚¿ãƒ ç§»è¡Œã‚¹ãƒ†ãƒ¼ã‚¸
    static let migrateV1toV2 = MigrationStage.custom(
        fromVersion: SampleTripsSchemaV1.self,
        toVersion: SampleTripsSchemaV2.self,
        willMigrate: { context in
            let trips = try? context.fetch(FetchDescriptor<SampleTripsSchemaV1.Trip>())
                      
            // Tripã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®é‡è¤‡ã‚’å‰Šé™¤
                      
            try? context.save() 
        }, didMigrate: nil
    )
  
    // ãƒãƒ¼ã‚¸ãƒ§ãƒ³2ã‹ã‚‰3ã¸ã®è»½é‡ç§»è¡Œã‚¹ãƒ†ãƒ¼ã‚¸
    static let migrateV2toV3 = MigrationStage.lightweight(
        fromVersion: SampleTripsSchemaV2.self,
        toVersion: SampleTripsSchemaV3.self
    )
}
```

### ç§»è¡Œãƒ—ãƒ©ãƒ³ã®è¨­å®š

æœ€å¾Œã«ã€ç§»è¡Œãƒ—ãƒ©ãƒ³ã‚’è¨­å®šã—ã¦ã€ã‚¹ã‚­ãƒ¼ãƒç§»è¡Œã‚’è¡Œã„ã¾ã™ã€‚

```swift
// ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆã‚’å®šç¾©
struct TripsApp: App {
    // ãƒ¢ãƒ‡ãƒ«ã‚³ãƒ³ãƒ†ãƒŠã‚’è¨­å®š
    let container = ModelContainer(
        for: Trip.self, 
        migrationPlan: SampleTripsMigrationPlan.self
    )
    
    var body: some Scene {
        WindowGroup {
            ContentView()
        }
        .modelContainer(container)
    }
}
```

ã“ã‚Œã§ã€SwiftDataã‚’ä½¿ç”¨ã—ãŸãƒ¢ãƒ‡ãƒ«ã®ã‚¹ã‚­ãƒ¼ãƒä½œæˆã¨ç§»è¡ŒãŒå®Œäº†ã§ã™ã€‚ã‚¹ã‚­ãƒ¼ãƒãƒã‚¯ãƒ­ã‚’æ´»ç”¨ã—ã¦ã‚¹ã‚­ãƒ¼ãƒã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’ä¼ãˆã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®é€²åŒ–ã«ä¼´ã£ã¦ãƒãƒ¼ã‚¸ãƒ§ãƒ³åŒ–ã•ã‚ŒãŸã‚¹ã‚­ãƒ¼ãƒã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£ã™ã‚‹ã“ã¨ã§ã€ã‚¹ãƒ ãƒ¼ã‚ºãªç§»è¡Œã‚’å®Ÿç¾ã§ãã¾ã™ã€‚è©³ç´°ã«ã¤ã„ã¦ã¯ã€SwiftDataã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

SwiftDataã¯ã€ã‚¢ãƒ—ãƒªã®ãƒ‡ãƒ¼ã‚¿ç®¡ç†ã‚’å¼·åŠ›ã‹ã¤æŸ”è»Ÿã«ã™ã‚‹ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã™ã€‚ã“ã®è¨˜äº‹ã‚’é€šã˜ã¦ã€SwiftDataã®åŸºæœ¬çš„ãªä½¿ã„æ–¹ã‹ã‚‰ã€ã‚¹ã‚­ãƒ¼ãƒã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã¨ç§»è¡Œæ–¹æ³•ã¾ã§ã‚’å­¦ã³ã¾ã—ãŸã€‚æ¬¡ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§SwiftDataã‚’ä½¿ç”¨ã—ã¦ã¿ã¾ã—ã‚‡ã†
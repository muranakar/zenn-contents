---
title: "ï¼ï¼ï¼ï¼ï¼ï¼ï¼ã€Flutterã€‘æ—¥è¨˜ã‚¢ãƒ—ãƒªã®DBãƒ‡ãƒ¼ã‚¿ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ–¹æ³•"
emoji: "ğŸ‘‹"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [Flutter, Dart]
published: false
---

ã‚·ãƒ³ãƒ—ãƒ«ãª TODO ãƒªã‚¹ãƒˆã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å®Ÿè£…ã¨å„å½¢å¼ã§ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ–¹æ³•ã‚’èª¬æ˜ã—ã¾ã™ã€‚

```dart
import 'dart:io';
import 'package:path/path.dart';
import 'package:sqflite/sqflite.dart';
import 'package:path_provider/path_provider.dart';

class TodoDatabase {
  static final TodoDatabase instance = TodoDatabase._init();
  static Database? _database;

  TodoDatabase._init();

  // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ä½œæˆ
  Future<void> _createDB(Database db, int version) async {
    await db.execute('''
    CREATE TABLE todos (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      title TEXT,
      is_completed INTEGER,
      created_at TEXT
    )
    ''');
  }

  // ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
  Future<String> exportToTxt() async {
    final db = await _database;
    final todos = await db!.query('todos');

    final docDir = await getApplicationDocumentsDirectory();
    final txtFile = File(join(docDir.path, 'todos.txt'));

    final buffer = StringBuffer();
    buffer.writeln('===== TODOãƒªã‚¹ãƒˆ =====');

    for (var todo in todos) {
      buffer.writeln('ID: ${todo['id']}');
      buffer.writeln('ã‚¿ã‚¹ã‚¯: ${todo['title']}');
      buffer.writeln('çŠ¶æ…‹: ${todo['is_completed'] == 1 ? 'å®Œäº†' : 'æœªå®Œäº†'}');
      buffer.writeln('ä½œæˆæ—¥æ™‚: ${todo['created_at']}');
      buffer.writeln('-------------------');
    }

    await txtFile.writeAsString(buffer.toString());
    return txtFile.path;
  }

  // CSVãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
  Future<String> exportToCsv() async {
    final db = await _database;
    final todos = await db!.query('todos');

    final docDir = await getApplicationDocumentsDirectory();
    final csvFile = File(join(docDir.path, 'todos.csv'));

    final buffer = StringBuffer();
    buffer.writeln('id,title,is_completed,created_at');

    for (var todo in todos) {
      final values = [
        todo['id'],
        '"${todo['title']}"',
        todo['is_completed'],
        todo['created_at']
      ];
      buffer.writeln(values.join(','));
    }

    await csvFile.writeAsString(buffer.toString());
    return csvFile.path;
  }

  // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
  Future<String> exportDatabase() async {
    try {
      if (_database != null && _database!.isOpen) {
        await _database!.close();
        _database = null;
      }

      final dbPath = await getDatabasesPath();
      final dbFile = File(join(dbPath, 'todo.db'));

      final docDir = await getApplicationDocumentsDirectory();
      final backupPath = join(docDir.path, 'todo_backup.db');

      await dbFile.copy(backupPath);
      return backupPath;
    } catch (e) {
      print('ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚¨ãƒ©ãƒ¼: $e');
      rethrow;
    }
  }

  // ãƒ‡ãƒ¼ã‚¿ã®è¿½åŠ ä¾‹
  Future<void> insertTodo(String title) async {
    final db = await _database;
    await db!.insert('todos', {
      'title': title,
      'is_completed': 0,
      'created_at': DateTime.now().toIso8601String()
    });
  }
}

// ä½¿ç”¨ä¾‹
void example() async {
  // ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã®è¿½åŠ 
  await TodoDatabase.instance.insertTodo('è²·ã„ç‰©ã«è¡Œã');
  await TodoDatabase.instance.insertTodo('æœ¬ã‚’èª­ã‚€');

  // å„å½¢å¼ã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
  final txtPath = await TodoDatabase.instance.exportToTxt();
  print('ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ: $txtPath');

  final csvPath = await TodoDatabase.instance.exportToCsv();
  print('CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ: $csvPath');

  final dbPath = await TodoDatabase.instance.exportDatabase();
  print('ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—: $dbPath');
}
```

# å„å½¢å¼ã§ã®å‡ºåŠ›ä¾‹

## 1. ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ« (todos.txt)

```text
===== TODOãƒªã‚¹ãƒˆ =====
ID: 1
ã‚¿ã‚¹ã‚¯: è²·ã„ç‰©ã«è¡Œã
çŠ¶æ…‹: æœªå®Œäº†
ä½œæˆæ—¥æ™‚: 2024-01-21T10:00:00
-------------------
ID: 2
ã‚¿ã‚¹ã‚¯: æœ¬ã‚’èª­ã‚€
çŠ¶æ…‹: æœªå®Œäº†
ä½œæˆæ—¥æ™‚: 2024-01-21T10:05:00
-------------------
```

## 2. CSV ãƒ•ã‚¡ã‚¤ãƒ« (todos.csv)

```csv
id,title,is_completed,created_at
1,"è²·ã„ç‰©ã«è¡Œã",0,2024-01-21T10:00:00
2,"æœ¬ã‚’èª­ã‚€",0,2024-01-21T10:05:00
```

## 3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ« (todo.db)

- SQLite ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«
- ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ ï¼š

```sql
CREATE TABLE todos (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  title TEXT,
  is_completed INTEGER,
  created_at TEXT
)
```

## ä¸»ãªæ©Ÿèƒ½

1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ä½œæˆ

```dart
await db.execute('''
CREATE TABLE todos (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  title TEXT,
  is_completed INTEGER,
  created_at TEXT
)
''');
```

2. ãƒ‡ãƒ¼ã‚¿ã®è¿½åŠ 

```dart
await database.insert('todos', {
  'title': title,
  'is_completed': 0,
  'created_at': DateTime.now().toIso8601String()
});
```

3. ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã®ä½œæˆ

```dart
final dbFile = File(join(dbPath, 'todo.db'));
final backupPath = join(docDir.path, 'todo_backup.db');
await dbFile.copy(backupPath);
```

## ä½¿ç”¨æ–¹æ³•

```dart
final db = TodoDatabase.instance;

// ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
final txtPath = await db.exportToTxt();

// CSVãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
final csvPath = await db.exportToCsv();

// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
final dbPath = await db.exportDatabase();
```

ã“ã®å®Ÿè£…ã«ã‚ˆã‚Šã€ã‚·ãƒ³ãƒ—ãƒ«ãª TODO ãƒªã‚¹ãƒˆã®ãƒ‡ãƒ¼ã‚¿ã‚’å„å½¢å¼ã§ç°¡å˜ã«ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã§ãã¾ã™ã€‚ãƒ‡ãƒ¼ã‚¿æ§‹é€ ãŒã‚·ãƒ³ãƒ—ãƒ«ãªãŸã‚ã€å½¢å¼é–“ã®å¤‰æ›ã‚‚å®¹æ˜“ã§ã™ã€‚

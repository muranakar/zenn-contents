---
title: "ã€Workoutã€‘iOSç«¯æœ«ã‹ã‚‰AppleWatchã‚’èµ·å‹•ã™ã‚‹"
emoji: "ğŸƒ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [iOS,Swift,SwiftUI,HealthKit]
published: false
---

## iPhoneã‹ã‚‰AppleWatchã®èµ·å‹•

```swift
 let configuration = HKWorkoutConfiguration()
configuration.activityType = .running
configuration.locationType = .outdoor

do {
    try await store.startWatchApp(toHandle: configuration)
}
catch {
    // ã“ã“ã§ã‚¨ãƒ©ãƒ¼ã‚’å‡¦ç†ã—ã¾ã™ã€‚
    fatalError("*** Apple Watchã§ãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¦ãƒˆã‚’é–‹å§‹ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: \(error.localizedDescription) ***")
}

logger.debug("*** ãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¦ãƒˆã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒé–‹å§‹ã•ã‚Œã¾ã—ãŸ ***")
```

## AppleWatchã«iPhoneã§è¨­å®šã—ãŸWorkoutå†…å®¹ã‚’æ¸¡ã™

[`startWatchApp(with:completion:)`](https://developer.apple.com/documentation/healthkit/hkhealthstore/1648358-startwatchapp)ã‚’å®Ÿè¡Œã—ãŸéš›ã«ã€AppleWatchå´ã§å®Ÿè¡Œã•ã‚Œã‚‹å‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹ã€‚`WKApplicationDelegate`ã‚’ç”¨ã„ã¦ã€[`handle(_:)`](https://developer.apple.com/documentation/watchkit/wkextensiondelegate/1650871-handle)ã§ãƒ‡ãƒªã‚²ãƒ¼ãƒˆãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè£…ã™ã‚‹ã€‚

```swift
class AppDelegate: NSObject, WKApplicationDelegate {
    func handle(_ workoutConfiguration: HKWorkoutConfiguration) {
        Task {
            do {
                WorkoutManager.shared.resetWorkout()
                try await WorkoutManager.shared.startWorkout(workoutConfiguration: workoutConfiguration)
                Logger.shared.log("ãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¦ãƒˆã®é–‹å§‹ã«æˆåŠŸã—ã¾ã—ãŸ")
            } catch {
                Logger.shared.log("ãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¦ãƒˆã®é–‹å§‹ã«å¤±æ•—ã—ã¾ã—ãŸ")
            }
        }
    }
}
```

Mainã®Viewã«ApplicationDelegateã‚’è¨­å®šã™ã‚‹ã€‚

```swift
@main
struct MirroringWorkoutsSampleWatchApp: App {
    @WKApplicationDelegateAdaptor(AppDelegate.self) private var appDelegate
    private let workoutManager = WorkoutManager.shared

    @SceneBuilder var body: some Scene {
        WindowGroup {
            PagingView()
                .environmentObject(workoutManager)
        }
    }
}
```
